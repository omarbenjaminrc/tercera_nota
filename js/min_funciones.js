const URL="164.92.84.70:3000",encabezados={cliente:["id_cliente","dv","nombres","apellidos","email","celular","fecha_registro"],gestion:["id_gestion","id_usuario","id_cliente","id_tipo_gestion","id_resultado","comentarios","fecha_registro"],resultado:["id_resultado","nombre_resultado","fecha_registro"],tipo_gestion:["id_tipo_gestion","nombre_tipo_gestion","fecha_registro"],usuario:["id_usuario","dv","nombres","apellidos","email","celular","username","password","fecha_registro"]},encabezados_b={cliente:["id_cliente","dv","nombres","apellidos","email","celular"],gestion:["id_usuario","id_cliente","id_tipo_gestion","id_resultado","comentarios"],resultado:["nombre_resultado"],tipo_gestion:["nombre_tipo_gestion"],usuario:["id_usuario","dv","nombres","apellidos","email","celular","username","password"]},agregar=()=>{const e=obtener_variable_url("tabla"),t=crear_objeto_raw(e);let o=new Headers;o.append("Content-Type","application/json");let a=JSON.stringify(t);fetch(`http://${URL}/api/${e}`,{method:"POST",headers:o,body:a,redirect:"follow"}).then((e=>{alert(200==e.status?"Se pudo ingresar el registro":"No se pudo ingresar el registro")})).then((e=>console.log(e))).catch((e=>console.log("error",e)))},actualizar=()=>{const e=obtener_variable_url("tabla"),t=crear_objeto_raw(e),o=obtener_variable_url("id");let a=new Headers;a.append("Content-Type","application/json");let r=JSON.stringify(t);fetch(`http://${URL}/api/${e}/${o}`,{method:"PATCH",headers:a,body:r,redirect:"follow"}).then((e=>{alert(200==e.status?"Se pudo actualizar el registro":"No se pudo actualizar el registro")})).then((e=>console.log(e))).catch((e=>console.log("error",e)))},eliminar=()=>{const e=obtener_variable_url("tabla"),t=obtener_variable_url("id");fetch(`http://${URL}/api/${e}/${t}`,{method:"DELETE",redirect:"follow"}).then((e=>{alert(200==e.status?"Se pudo eliminar el registro":"No se pudo eliminar el registro")})).then((e=>console.log(e))).catch((e=>console.log("error",e)))},obtener=()=>{const e=obtener_variable_url("tabla");if("gestion"===e)obtener_gestion();else{crear_encabezados(e),fetch(`http://${URL}/api/${e}?_size=100`,{method:"GET",redirect:"follow"}).then((e=>e.json())).then((e=>e.forEach(crear_contenido_tabla))).then((e=>console.log(e))).catch((e=>console.log("error",e)))}},obtener_gestion=()=>{document.querySelector("#encabezado").innerHTML+="<th>id_gestion</th><th>cliente</th><th>usuario</th><th>comentarios</th><th>tipo_gestion</th><th>resultado</th><th>fecha_registro</th>\n    ";let e=new Headers;e.append("Content-Type","application/json");let t=JSON.stringify({query:"select g.id_gestion,CONCAT(c.nombres, ' ',c.apellidos) as cliente,CONCAT(u.nombres, ' ',u.apellidos) as usuario,g.comentarios,tg.nombre_tipo_gestion as 'tipo gestiÃ³n',r.nombre_resultado as resultado,g.fecha_registro from gestion g,cliente c, usuario u, tipo_gestion tg,resultado r where g.id_cliente = c.id_cliente and g.id_usuario = u.id_usuario and g.id_resultado = r.id_resultado and g.id_tipo_gestion = tg.id_tipo_gestion"});fetch(`http://${URL}/dynamic`,{method:"POST",headers:e,body:t,redirect:"follow"}).then((e=>e.json())).then((e=>e.forEach(crear_contenido_tabla))).then((e=>console.log(e))).catch((e=>console.log("error",e)))},obtener_uno=e=>{const t=obtener_variable_url("tabla"),o=obtener_variable_url("id");fetch(`http://${URL}/api/${t}/${o}`,{method:"GET",redirect:"follow"}).then((e=>e.json())).then((t=>t.forEach(e))).then((e=>console.log(e))).catch((e=>console.log("error",e)))},crear_encabezados=()=>{tabla=obtener_variable_url("tabla"),thead_table=document.querySelector("#encabezado");for(const e of encabezados[tabla])thead_table.innerHTML+=`<th>${e}</th>`;thead_table.innerHTML+="<th> acciones </th>"},crear_contenido_tabla=(e,t,o)=>{let a=obtener_variable_url("tabla");objeto=Object.keys(e);let r="<tr>";for(const t in e)r+=`<td>${e[t]}</td>`;r+=`<td>\n        <a href = formulario.html?tabla=${a}&id=${e[objeto[0]]}&accion=eliminar> \n            <button class="btn btn-outline-danger">\n                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-trash3" viewBox="0 0 16 16">\n                    <path d="M6.5 1h3a.5.5 0 0 1 .5.5v1H6v-1a.5.5 0 0 1 .5-.5ZM11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3A1.5 1.5 0 0 0 5 1.5v1H2.506a.58.58 0 0 0-.01 0H1.5a.5.5 0 0 0 0 1h.538l.853 10.66A2 2 0 0 0 4.885 16h6.23a2 2 0 0 0 1.994-1.84l.853-10.66h.538a.5.5 0 0 0 0-1h-.995a.59.59 0 0 0-.01 0H11Zm1.958 1-.846 10.58a1 1 0 0 1-.997.92h-6.23a1 1 0 0 1-.997-.92L3.042 3.5h9.916Zm-7.487 1a.5.5 0 0 1 .528.47l.5 8.5a.5.5 0 0 1-.998.06L5 5.03a.5.5 0 0 1 .47-.53Zm5.058 0a.5.5 0 0 1 .47.53l-.5 8.5a.5.5 0 1 1-.998-.06l.5-8.5a.5.5 0 0 1 .528-.47ZM8 4.5a.5.5 0 0 1 .5.5v8.5a.5.5 0 0 1-1 0V5a.5.5 0 0 1 .5-.5Z"/>\n                </svg>\n            </button> \n        </a>\n        <a href = "formulario.html?tabla=${a}&id=${e[objeto[0]]}&accion=editar"> \n            <button class="btn btn-outline-primary">\n                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-pencil-square" viewBox="0 0 16 16">\n                    <path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/>\n                    <path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z"/>\n                </svg>\n            </button> \n        </a>\n    </td>\n    `,o[t]=document.querySelector("tbody").innerHTML+=r,o[t]=document.querySelector("tbody").innerHTML+="</tr>"},obtener_comprobacion=e=>{id=document.querySelector(`#${e}`).value,tabla=e.slice(3);fetch(`http://${URL}/api/${tabla}/${id}`,{method:"GET",redirect:"follow"}).then((e=>e.json())).then((e=>{console.log(e),alert(e[0][`id_${tabla}`]==id?"Existe en la base de datos":"No existe en la base de datos")})).catch((e=>{alert("No existe en la base de datos"),console.log("error",e)}))},crear_formulario=()=>{tabla=obtener_variable_url("tabla");const e=document.querySelector("fieldset");for(const t of encabezados_b[tabla])e.innerHTML+=`\n            <div class="input-group mb-2" id="div_${t}">\n                <span class="input-group-text col-3">${t} </span>\n                <input id="${t}" type="text" class="form-control col-4" placeholder="${t}" aria-label="${t}" aria-describedby="${t}">\n            </div>\n        `;if("gestion"===tabla){let e=["id_usuario","id_cliente","id_tipo_gestion","id_resultado"];for(const t of e){document.querySelector(`#div_${t}`).innerHTML+=`<input type= "button" value="comprobar" onclick="obtener_comprobacion('${t}')">`}}},crear_objeto_raw=()=>{tabla=obtener_variable_url("tabla");let e={};for(const t of encabezados_b[tabla])e[t]=document.querySelector(`#${t}`).value;return e},determinar_accion=()=>{const e=obtener_variable_url("accion"),t=obtener_variable_url("tabla"),o=document.querySelector("#boton_accion"),a=document.querySelector("h2");if("agregar"===e)a.innerText+=`Ingresar dato en tabla ${t}`,o.innerHTML+="Agregar",o.addEventListener("click",(()=>{agregar()}));else if("eliminar"===e)a.innerText+=`Eliminar dato en tabla ${t}`,o.innerHTML+="Eliminar",obtener_uno(inyectar_valor),formulario=document.querySelector("fieldset"),formulario.setAttribute("disabled",""),o.addEventListener("click",(()=>{eliminar()}));else if("editar"===e){a.innerText+=`Actualizar dato en tabla ${t}`,o.innerHTML+="Actualizar",document.querySelector(`#${encabezados[t][0]}`).setAttribute("disabled",""),obtener_uno(inyectar_valor),o.addEventListener("click",(()=>{actualizar()}))}},inyectar_valor=(e,t,o)=>{for(const t in e){document.querySelector(`#${t}`).setAttribute("value",`${e[t]}`)}},obtener_variable_url=e=>{let t=window.location.search;return new URLSearchParams(t).get(`${e}`)};